<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Surf Spot Panel Accessibility Test</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            padding: 2rem;
            background-color: #f5f5f5;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .test-header {
            background-color: #0077BE;
            color: white;
            padding: 1.5rem;
        }
        
        .test-content {
            padding: 2rem;
        }
        
        .test-section {
            margin-bottom: 2rem;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .test-section-header {
            background-color: #f5f5f5;
            padding: 1rem;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .test-section-content {
            padding: 1rem;
        }
        
        .test-result {
            padding: 0.5rem 1rem;
            margin: 0.5rem 0;
            border-radius: 4px;
        }
        
        .test-pass {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .test-fail {
            background-color: #ffebee;
            color: #c62828;
        }
        
        .test-info {
            background-color: #e3f2fd;
            color: #1565c0;
        }
        
        .panel-container {
            width: 100%;
            height: 600px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .instructions {
            background-color: #fff8e1;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
        }
        
        .keyboard-test {
            margin-top: 1rem;
        }
        
        .keyboard-test h3 {
            margin-bottom: 0.5rem;
        }
        
        .keyboard-test ul {
            margin-left: 1.5rem;
        }
        
        .keyboard-test li {
            margin-bottom: 0.25rem;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <header class="test-header">
            <h1>Surf Spot Panel Accessibility Test</h1>
            <p>This page tests the WCAG 2.1 AA compliance of the enhanced surf spot details panel.</p>
        </header>
        
        <div class="test-content">
            <div class="instructions">
                <h2>Test Instructions</h2>
                <p>Use the following methods to test the accessibility features:</p>
                <ul>
                    <li><strong>Keyboard Navigation:</strong> Use Tab, Shift+Tab, Enter, Space, and Arrow keys to navigate through the panel.</li>
                    <li><strong>Screen Reader:</strong> Test with NVDA, JAWS, or VoiceOver to verify announcements.</li>
                    <li><strong>Visual Accessibility:</strong> Test with high contrast mode and reduced motion preferences.</li>
                    <li><strong>Focus Management:</strong> Verify that focus is properly trapped within the panel.</li>
                </ul>
            </div>
            
            <div class="test-section">
                <div class="test-section-header">
                    <h2>ARIA Implementation Test</h2>
                </div>
                <div class="test-section-content">
                    <div id="aria-results" class="test-results">
                        <!-- Test results will be populated here -->
                    </div>
                </div>
            </div>
            
            <div class="test-section">
                <div class="test-section-header">
                    <h2>Keyboard Navigation Test</h2>
                </div>
                <div class="test-section-content">
                    <div class="keyboard-test">
                        <h3>Test the following keyboard interactions:</h3>
                        <ul>
                            <li>Tab through all interactive elements</li>
                            <li>Shift+Tab to navigate backwards</li>
                            <li>Enter or Space to activate buttons and expandable sections</li>
                            <li>Arrow keys to navigate within compass and calendar</li>
                            <li>Escape to close the panel</li>
                            <li>Home/End to navigate to first/last elements</li>
                            <li>PageUp/PageDown to switch between tabs</li>
                        </ul>
                    </div>
                    <div id="keyboard-results" class="test-results">
                        <!-- Test results will be populated here -->
                    </div>
                </div>
            </div>
            
            <div class="test-section">
                <div class="test-section-header">
                    <h2>Screen Reader Test</h2>
                </div>
                <div class="test-section-content">
                    <div class="keyboard-test">
                        <h3>Verify the following screen reader announcements:</h3>
                        <ul>
                            <li>Panel title and purpose when opened</li>
                            <li>Tab changes and content updates</li>
                            <li>Section expand/collapse states</li>
                            <li>Compass direction descriptions</li>
                            <li>Calendar month information</li>
                            <li>Tide condition indicators</li>
                        </ul>
                    </div>
                    <div id="screen-reader-results" class="test-results">
                        <!-- Test results will be populated here -->
                    </div>
                </div>
            </div>
            
            <div class="test-section">
                <div class="test-section-header">
                    <h2>Visual Accessibility Test</h2>
                </div>
                <div class="test-section-content">
                    <div class="keyboard-test">
                        <h3>Test the following visual features:</h3>
                        <ul>
                            <li>Focus indicators are clearly visible</li>
                            <li>High contrast mode support</li>
                            <li>Text scaling up to 200%</li>
                            <li>Reduced motion preferences</li>
                            <li>Color independence (information not conveyed by color alone)</li>
                        </ul>
                    </div>
                    <div id="visual-results" class="test-results">
                        <!-- Test results will be populated here -->
                    </div>
                </div>
            </div>
            
            <div class="test-section">
                <div class="test-section-header">
                    <h2>Surf Spot Panel</h2>
                </div>
                <div class="test-section-content">
                    <button id="open-panel-btn" class="cta-button">Open Test Surf Spot Panel</button>
                    <div id="panel-container" class="panel-container"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { SurfSpotPanel } from './scripts/surf-map/surf-spot-panel.js';
        
        // Test data for a surf spot
        const testSpotData = {
            id: 'test-spot',
            primaryName: 'Test Break',
            alternativeNames: ['Testing Point', 'Demo Beach'],
            description: 'This is a test surf spot used for accessibility validation. It features various wave conditions, facilities, and accessibility features.',
            location: {
                area: 'Test Coast',
                nearestTowns: ['Testville', 'Demo City'],
                coordinates: { lat: 28.5, lng: -16.5 }
            },
            waveDetails: {
                type: ['Beach Break', 'Reef Break'],
                direction: ['N', 'NW'],
                directionNotes: 'Works best with north swells',
                bestSwellDirection: ['N', 'NW'],
                bestWindDirection: ['S', 'SE'],
                bestTide: ['Low', 'Mid'],
                tideNotes: 'Best at low to mid tide',
                bestSeason: ['Winter', 'Spring'],
                idealConditions: 'North swell with south wind at low tide',
                abilityLevel: { primary: 'Intermediate', alsoSuitableFor: ['Advanced', 'Beginner'] }
            },
            characteristics: {
                crowdFactor: 'Medium',
                crowdNotes: 'Can get crowded on weekends',
                localVibe: 'Friendly and welcoming',
                hazards: ['Rocks', 'Currents'],
                bottom: ['Sand', 'Reef'],
                waterQuality: 'Good'
            },
            practicalities: {
                access: 'Easy access from the main road with a short walk to the beach',
                parking: 'Free parking available at the beach entrance',
                facilities: 'Restrooms and showers available',
                paddleOut: 'Short paddle of 50-100 meters from the beach',
                recommendedBoards: ['Shortboard', 'Funboard', 'Longboard'],
                additionalTips: 'Best in the morning before the wind picks up'
            }
        };
        
        // Initialize the panel
        const panelContainer = document.getElementById('panel-container');
        const openPanelBtn = document.getElementById('open-panel-btn');
        
        const surfPanel = new SurfSpotPanel({
            container: panelContainer,
            enableAnimations: true,
            enableTooltips: true,
            enableKeyboardNav: true,
            onClose: () => {
                console.log('Panel closed');
            }
        });
        
        // Open panel when button is clicked
        openPanelBtn.addEventListener('click', () => {
            const content = surfPanel.generateContent(testSpotData);
            panelContainer.innerHTML = '';
            panelContainer.appendChild(content);
            
            // Run accessibility tests after panel is created
            setTimeout(() => {
                runAccessibilityTests();
            }, 100);
        });
        
        // Function to run accessibility tests
        function runAccessibilityTests() {
            // Test ARIA implementation
            testAriaImplementation();
            
            // Test keyboard navigation
            testKeyboardNavigation();
            
            // Test screen reader support
            testScreenReaderSupport();
            
            // Test visual accessibility
            testVisualAccessibility();
        }
        
        // Test ARIA implementation
        function testAriaImplementation() {
            const results = document.getElementById('aria-results');
            results.innerHTML = '';
            
            // Test for proper ARIA roles
            const panel = document.querySelector('.surf-spot-panel');
            addTestResult(results, panel?.getAttribute('role') === 'article', 
                'Panel has proper article role');
            
            // Test for ARIA labels
            const header = document.querySelector('.surf-spot-header');
            addTestResult(results, header?.hasAttribute('aria-label'), 
                'Header has aria-label');
            
            // Test for navigation landmarks
            const nav = document.querySelector('.surf-spot-nav');
            addTestResult(results, nav?.getAttribute('role') === 'tablist', 
                'Navigation has proper tablist role');
            
            // Test for tab panels
            const tabPanels = document.querySelectorAll('.tab-panel');
            let allTabPanelsHaveRole = true;
            tabPanels.forEach(panel => {
                if (panel.getAttribute('role') !== 'tabpanel') {
                    allTabPanelsHaveRole = false;
                }
            });
            addTestResult(results, allTabPanelsHaveRole, 
                'All tab panels have proper tabpanel role');
            
            // Test for expandable sections
            const expandableSections = document.querySelectorAll('.expandable-section');
            let allSectionsHaveRole = true;
            expandableSections.forEach(section => {
                if (section.getAttribute('role') !== 'region') {
                    allSectionsHaveRole = false;
                }
            });
            addTestResult(results, allSectionsHaveRole, 
                'All expandable sections have proper region role');
            
            // Test for compass accessibility
            const compass = document.querySelector('.direction-compass');
            addTestResult(results, compass?.getAttribute('role') === 'application', 
                'Compass has proper application role');
            
            // Test for calendar accessibility
            const calendar = document.querySelector('.seasonal-calendar');
            addTestResult(results, calendar?.getAttribute('role') === 'grid', 
                'Calendar has proper grid role');
        }
        
        // Test keyboard navigation
        function testKeyboardNavigation() {
            const results = document.getElementById('keyboard-results');
            results.innerHTML = '';
            
            // Test for focusable elements
            const focusableElements = document.querySelectorAll(
                'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
            addTestResult(results, focusableElements.length > 0, 
                `Found ${focusableElements.length} focusable elements`);
            
            // Test for tab navigation
            const firstElement = focusableElements[0];
            const lastElement = focusableElements[focusableElements.length - 1];
            
            if (firstElement && lastElement) {
                addTestResult(results, true, 
                    'Tab navigation is properly set up');
            }
            
            // Test for keyboard shortcuts
            const tabs = document.querySelectorAll('.nav-tab');
            addTestResult(results, tabs.length > 0, 
                `Found ${tabs.length} navigation tabs`);
            
            // Test for expandable sections keyboard support
            const sectionHeaders = document.querySelectorAll('.section-header');
            addTestResult(results, sectionHeaders.length > 0, 
                `Found ${sectionHeaders.length} expandable sections with keyboard support`);
        }
        
        // Test screen reader support
        function testScreenReaderSupport() {
            const results = document.getElementById('screen-reader-results');
            results.innerHTML = '';
            
            // Test for screen reader only content
            const srOnlyElements = document.querySelectorAll('.sr-only');
            addTestResult(results, srOnlyElements.length > 0, 
                `Found ${srOnlyElements.length} screen reader only elements`);
            
            // Test for live regions
            const liveRegions = document.querySelectorAll('[aria-live]');
            addTestResult(results, liveRegions.length > 0, 
                `Found ${liveRegions.length} live regions for dynamic content`);
            
            // Test for descriptive labels
            const images = document.querySelectorAll('img');
            let allImagesHaveAlt = true;
            images.forEach(img => {
                if (!img.hasAttribute('alt')) {
                    allImagesHaveAlt = false;
                }
            });
            addTestResult(results, allImagesHaveAlt, 
                'All images have alt attributes');
            
            // Test for heading structure
            const headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6');
            addTestResult(results, headings.length > 0, 
                `Found ${headings.length} headings for proper structure`);
        }
        
        // Test visual accessibility
        function testVisualAccessibility() {
            const results = document.getElementById('visual-results');
            results.innerHTML = '';
            
            // Test for focus indicators
            const focusableElements = document.querySelectorAll(
                'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
            
            // Check if focus styles are defined
            const styleSheets = Array.from(document.styleSheets);
            let hasFocusStyles = false;
            
            try {
                styleSheets.forEach(sheet => {
                    try {
                        const rules = Array.from(sheet.cssRules || sheet.rules || []);
                        rules.forEach(rule => {
                            if (rule.cssText && (
                                rule.cssText.includes(':focus') || 
                                rule.cssText.includes('focus-visible')
                            )) {
                                hasFocusStyles = true;
                            }
                        });
                    } catch (e) {
                        // Cross-origin stylesheets may throw errors
                    }
                });
            } catch (e) {
                console.error('Error checking focus styles:', e);
            }
            
            addTestResult(results, hasFocusStyles, 
                'Focus styles are defined');
            
            // Test for color contrast (basic check)
            const textElements = document.querySelectorAll('p, h1, h2, h3, h4, h5, h6, span, div');
            addTestResult(results, textElements.length > 0, 
                `Found ${textElements.length} text elements for contrast testing`);
            
            // Test for responsive design
            const viewportMeta = document.querySelector('meta[name="viewport"]');
            addTestResult(results, viewportMeta?.getAttribute('content')?.includes('width=device-width'), 
                'Viewport meta tag is set for responsive design');
        }
        
        // Helper function to add test results
        function addTestResult(container, passed, message) {
            const result = document.createElement('div');
            result.className = `test-result ${passed ? 'test-pass' : 'test-fail'}`;
            result.textContent = `${passed ? '✓' : '✗'} ${message}`;
            container.appendChild(result);
        }
        
        // Add informational message about manual testing
        function addInfoMessage(container, message) {
            const result = document.createElement('div');
            result.className = 'test-result test-info';
            result.textContent = `ℹ ${message}`;
            container.appendChild(result);
        }
        
        // Add info messages for manual testing
        const ariaResults = document.getElementById('aria-results');
        addInfoMessage(ariaResults, 'Manual testing with a screen reader is recommended for full validation.');
        
        const keyboardResults = document.getElementById('keyboard-results');
        addInfoMessage(keyboardResults, 'Test keyboard navigation by using Tab, Enter, and Arrow keys.');
        
        const screenReaderResults = document.getElementById('screen-reader-results');
        addInfoMessage(screenReaderResults, 'Test with NVDA, JAWS, or VoiceOver for complete validation.');
        
        const visualResults = document.getElementById('visual-results');
        addInfoMessage(visualResults, 'Test with high contrast mode and reduced motion preferences.');
    </script>
</body>
</html>